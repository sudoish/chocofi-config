# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

ZMK firmware configuration for a 34/36-key Chocofi split keyboard using the QWERTY layout. Also supports a Zilpzalp keyboard variant. Heavily inspired by [Urob's zmk-config](https://github.com/urob/zmk-config). Uses Urob's ZMK fork (not upstream) via `config/west.yml`.

## Build & Deploy

Firmware is built via GitHub Actions on push/PR (`build.yaml` defines the matrix). There is no local build — push to trigger CI, then download the `.uf2` artifacts from the Actions run. The board is `nice_nano_v2` with `nice_view` display.

The keymap visualization SVGs are auto-generated by a second GitHub Action (`draw.yml`) using [keymap-drawer](https://github.com/caksoylar/keymap-drawer) on changes to `config/*.keymap`, `config/*.dtsi`, or `keymap_drawer/draw_config.yaml`.

## Architecture

### Keymap Structure

`config/base.keymap` is the shared keymap — **this is the main file to edit**. Board-specific keymaps just set preprocessor flags and `#include "base.keymap"`:

- `chocofi.keymap`: `WIRELESS=1`, `ALPHA_23332=1` (36-key, Bluetooth)
- `zilpzalp.keymap`: `WIRELESS=0`, `ALPHA_13332=1` (wired, 34-key)
- `dummy.keymap`: `WIRELESS=1`, `DUMMY_KEEB=1` (used only for drawing all keys/combos in SVG)

### Layers (defined in base.keymap)

0=BASE, 1=NUM, 2=NAV, 3=SYM_L, 4=SYM_R, 5=ADJ, 6=LOCK

SYM is split into SYM_L (left-hand symbols, activated by right thumb) and SYM_R (right-hand symbols, activated by left thumb) for two-handed access. ADJ is a tri-layer activated when both SYM_L and SYM_R are held.

### Key Config Files

- `config/combos.dtsi` — combo definitions (uses macro `COMBO(name, positions, binding, layers)`)
- `config/chocofi.conf` / `config/zilpzalp.conf` — board-specific ZMK config (sleep, BT, mouse)

### Keymap Drawer Config

`keymap_drawer/draw_config.yaml` contains glyph definitions, raw binding display overrides, and ZMK keycode-to-symbol mappings for SVG generation. Edit this when adding new custom behaviors that need visual representation.

## Key Design Patterns

- **Timeless homerow mods (HRMs)**: `hml`/`hmr` behaviors with `require-prior-idle-ms` and positional hold-trigger to prevent misfires during fast typing
- **Mod-morphs**: Shift changes symbol output (e.g., `.` → `:`, `,` → `;`)
- **Tri-state swapper**: Cmd+Tab behavior using `zmk,behavior-tri-state` (requires Urob's fork)
- **Tri-layer**: SYM_L + SYM_R activates ADJ layer for system/media/bluetooth controls

## Key Positions Reference (for combos)

```
╭─────────────────────╮ ╭─────────────────────╮
│  00  01  02  03  04 │ │  05  06  07  08  09 │
│  10  11  12  13  14 │ │  15  16  17  18  19 │
│  20  21  22  23  24 │ │  25  26  27  28  29 │
╰───────╮  30  31  32 │ │  33  34  35 ╭───────╯
        ╰─────────────╯ ╰─────────────╯
```